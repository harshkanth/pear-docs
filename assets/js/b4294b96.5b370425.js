"use strict";(globalThis.webpackChunkpear_docs=globalThis.webpackChunkpear_docs||[]).push([[5833],{4322:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"pear-runtime/pear-troubleshooting","title":"Peer Troubleshooting","description":"The article aims to help troubleshooting confusing scenarios while developing Pear applications.","source":"@site/docs/pear-runtime/pear-troubleshooting.md","sourceDirName":"pear-runtime","slug":"/pear-runtime/pear-troubleshooting","permalink":"/docs/pear-runtime/pear-troubleshooting","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"pear-troubleshooting","title":"Peer Troubleshooting","sidebar_label":"Troubleshooting Peer","sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Migration","permalink":"/docs/pear-runtime/migration"},"next":{"title":"Initialization (Updated)","permalink":"/docs/step-by-step/start-a-desktop-project/desk-proj"}}');var o=i(4848),s=i(8453);const t={id:"pear-troubleshooting",title:"Peer Troubleshooting",sidebar_label:"Troubleshooting Peer",sidebar_position:6},a="Troubleshooting Applications",l={},c=[{value:"<code>Pear.teardown</code> Callback Fires But Worker Keeps Running",id:"pearteardown-callback-fires-but-worker-keeps-running",level:2},{value:"<code>pear</code> CLI Exits Without Running the Application",id:"pear-cli-exits-without-running-the-application",level:2},{value:"You get a <code>Error: While lock File .. Resource temporarily unavailable</code>",id:"you-get-a-error-while-lock-file--resource-temporarily-unavailable",level:2},{value:"Joining a Hyperswarm Topic takes a long time",id:"joining-a-hyperswarm-topic-takes-a-long-time",level:2},{value:"Running Bare modules in Pear Desktop Applications",id:"running-bare-modules-in-pear-desktop-applications",level:2}];function d(e){const n={a:"a",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"troubleshooting-applications",children:"Troubleshooting Applications"})}),"\n",(0,o.jsx)(n.p,{children:"The article aims to help troubleshooting confusing scenarios while developing Pear applications."}),"\n",(0,o.jsxs)(n.h2,{id:"pearteardown-callback-fires-but-worker-keeps-running",children:[(0,o.jsx)(n.code,{children:"Pear.teardown"})," Callback Fires But Worker Keeps Running"]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"Pear.teardown(cb)"})," callback is triggered whenever the Pear app start to unload. If it is not exiting, then something is keeping the applications event loop running. A common cause of this is not cleaning up the ",(0,o.jsx)(n.a,{href:"https://docs.pears.com/api#const-pipe-pear.worker.pipe",children:"worker pipe"})," by calling ",(0,o.jsx)(n.code,{children:"pipe.end()"})," to gracefully end the writable part of the stream."]}),"\n",(0,o.jsxs)(n.h2,{id:"pear-cli-exits-without-running-the-application",children:[(0,o.jsx)(n.code,{children:"pear"})," CLI Exits Without Running the Application"]}),"\n",(0,o.jsx)(n.p,{children:"If after debugging an application it seems the issue is happening in the Pear platform itself, try the following steps to debug the issue:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Run pear command with logs enabled ",(0,o.jsx)(n.code,{children:"pear --log [command]"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["If no helpful info, run sidecar with logs ",(0,o.jsx)(n.code,{children:"pear sidecar --log-level 3"}),".",(0,o.jsx)(n.br,{}),"\n","If the ",(0,o.jsx)(n.code,{children:"pear sidecar"})," stops after printing ",(0,o.jsx)(n.code,{children:"Closing any current Sidecar clients..."}),", then the current Pear Sidecar process is hanging. Check the next steps for forensics that might explain why, but then kill existing Pear processes.",(0,o.jsx)(n.br,{}),"\n","&#xNAN;",(0,o.jsx)(n.em,{children:"Note"})," that this will close any running pear applications such as Keet."]}),"\n",(0,o.jsxs)(n.li,{children:["If still no helpful info, check that there are still pear processes running via ",(0,o.jsx)(n.code,{children:"ps aux | grep pear"})," or equivalent method for finding processes by name."]}),"\n",(0,o.jsxs)(n.li,{children:["Finally check the crash logs in platform's ",(0,o.jsx)(n.code,{children:"current"})," directory.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["For sidecar: ",(0,o.jsx)(n.code,{children:"sidecar.crash.log"})]}),"\n",(0,o.jsxs)(n.li,{children:["For electron: ",(0,o.jsx)(n.code,{children:"electron-main.crash.log"})]}),"\n",(0,o.jsxs)(n.li,{children:["For pear cli: ",(0,o.jsx)(n.code,{children:"cli.crash.log"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.h2,{id:"you-get-a-error-while-lock-file--resource-temporarily-unavailable",children:["You get a ",(0,o.jsx)(n.code,{children:"Error: While lock File .. Resource temporarily unavailable"})]}),"\n",(0,o.jsx)(n.p,{children:"The Error:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Uncaught (in promise) Error: While lock file: ./pear/app-storage/by-random/.../db/LOCK: Resource temporarily unavailable\n    at Object.onopen (pear://dev/node_modules/rocksdb-native/lib/state.js:155:27)\n"})}),"\n",(0,o.jsx)(n.p,{children:"Means the application is trying to open a RockDB instance on files currently locked by another process. This means either:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["An application is trying to open the same storage twice.",(0,o.jsx)(n.br,{}),"\n","If using ",(0,o.jsx)(n.code,{children:"Corestore"}),", it is recommended to only create only one instance and reusing it."]}),"\n",(0,o.jsx)(n.li,{children:"There are multiple of processes running for the same application."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"joining-a-hyperswarm-topic-takes-a-long-time",children:"Joining a Hyperswarm Topic takes a long time"}),"\n",(0,o.jsx)(n.p,{children:"There can be many reasons but here are a few common reasons:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Random NAT networks can take longer as another node may be needed to facility the connection."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Not destroying the hyperswarm instance in the ",(0,o.jsx)(n.code,{children:"Pear.teardown()"})," callback so Hyperswarm can unannounce and clean up the DHT.",(0,o.jsx)(n.br,{}),"\n","It's recommended to clean up the hyperswarm instance with ",(0,o.jsx)(n.code,{children:"swarm.destroy()"})," before exiting the application. This prevents conflicting records in the DHT for the application's peer which cause it take longer to join a topic."]}),"\n",(0,o.jsx)(n.p,{children:"Example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"Pear.teardown(() => swarm.destroy())\n"})}),"\n",(0,o.jsx)(n.p,{children:"Make sure to unregister the teardown callback if the swarm is destroyed prematurely."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["A firewall is blocking the traffic.",(0,o.jsx)(n.br,{}),"\n","Please let Holepunch know if this is the case."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"running-bare-modules-in-pear-desktop-applications",children:"Running Bare modules in Pear Desktop Applications"}),"\n",(0,o.jsx)(n.p,{children:'For now this is not possible because Pear desktop applications run in Electron which uses Node.js integration. Pear v2 will unify running Pear applications in Bare with Electron as a UI module. This way the main application will be defined as a "Pear-end" process that can be shared across different versions of the application such as CLI, GUI, mobile, etc.'}),"\n",(0,o.jsx)(n.p,{children:"Running a Bare module will give you one of the following errors:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Uncaught TypeError: require.addon is not a function"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Uncaught ReferenceError: Bare is not defined"})}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["To support both Bare and Node.js compatible modules, import maps can be defined so a module ",(0,o.jsx)(n.code,{children:"fs"})," can be resolved to ",(0,o.jsx)(n.code,{children:"bare-fs"})," on Bare and ",(0,o.jsx)(n.code,{children:"fs"})," on Node.js."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'{\n  "imports": {\n    "fs": {\n      "bare": "bare-fs",\n      "default": "fs"\n    },\n    "fs/*": {\n      "bare": "bare-fs/*",\n      "default": "fs/*"\n    }\n  },\n  "dependencies": {\n    "bare-fs": "^2.1.5"\n  }\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["See ",(0,o.jsxs)(n.a,{href:"https://github.com/holepunchto/bare-node?tab=readme-ov-file#import-maps",children:[(0,o.jsx)(n.code,{children:"bare-node"}),'\'s "Import maps"']})," for more details."]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>a});var r=i(6540);const o={},s=r.createContext(o);function t(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);