"use strict";(globalThis.webpackChunkpear_docs=globalThis.webpackChunkpear_docs||[]).push([[6079],{286:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"how-to/connect-two-peers","title":"Connect Two Peers (Updated)","description":"This guide explains how two Pear applications can communicate directly using public-key addressing. It also demonstrates how to build a basic command-line chat application using the HyperDHT networking stack.","source":"@site/docs/how-to/connect-two-pears.md","sourceDirName":"how-to","slug":"/how-to/connect-two-peers","permalink":"/docs/how-to/connect-two-peers","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"id":"connect-two-peers","title":"Connect Two Peers (Updated)","sidebar_label":"Connect Two Peers (Updated)","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"hyperswarm","permalink":"/docs/modules/networking/hyperswarm"},"next":{"title":"drives","permalink":"/docs/tools/drives"}}');var r=t(4848),s=t(8453);const o={id:"connect-two-peers",title:"Connect Two Peers (Updated)",sidebar_label:"Connect Two Peers (Updated)",sidebar_position:1},c="Connect Two Peers",l={},a=[{value:"Overview",id:"overview",level:2},{value:"NAT traversal and hole-punching",id:"nat-traversal-and-hole-punching",level:3},{value:"Demo: Connect Two Terminal Applications",id:"demo-connect-two-terminal-applications",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"connect-two-peers",children:"Connect Two Peers"})}),"\n",(0,r.jsxs)(n.p,{children:["This guide explains how two Pear applications can communicate directly using public-key addressing. It also demonstrates how to build a basic command-line chat application using the ",(0,r.jsx)(n.code,{children:"HyperDHT"})," networking stack."]}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["Pear applications do not rely on centralized servers. Instead, they connect directly to each other over encrypted peer-to-peer channels. To make this possible, Pear uses ",(0,r.jsx)(n.strong,{children:"HyperDHT"}),", a distributed, peer-to-peer lookup network."]}),"\n",(0,r.jsx)(n.p,{children:"HyperDHT enables the following:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Peers are identified by a ",(0,r.jsx)(n.strong,{children:"public key"}),", not an IP address."]}),"\n",(0,r.jsxs)(n.li,{children:["A peer\u2019s public key is stored in a ",(0,r.jsx)(n.strong,{children:"distributed hash table (DHT)"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"When a client wants to connect to a peer, it looks up that public key in the DHT and retrieves the best available connection route."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This allows connections across different networks and changing IP addresses, including mobile and home Wi-Fi networks."}),"\n",(0,r.jsx)(n.h3,{id:"nat-traversal-and-hole-punching",children:"NAT traversal and hole-punching"}),"\n",(0,r.jsx)(n.p,{children:"HyperDHT attempts to establish direct connectivity between peers using multiple hole-punching techniques. When successful, communication happens directly between the two peers."}),"\n",(0,r.jsx)(n.p,{children:"However, if both peers are behind restrictive or randomizing NATs, direct connectivity may not succeed. In this case:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The connection must be relayed through a third peer."}),"\n",(0,r.jsx)(n.li,{children:"HyperDHT does not relay by default."}),"\n",(0,r.jsx)(n.li,{children:"Some Pear applications implement their own relay system. For example, in Keet calls, other participants automatically act as relays, improving connectivity as more peers join."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"demo-connect-two-terminal-applications",children:"Demo: Connect Two Terminal Applications"}),"\n",(0,r.jsx)(n.p,{children:"This demonstration implements a simple chat system between two terminal applications using HyperDHT:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.strong,{children:"server application"})," generates a key pair and listens for connections."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.strong,{children:"client application"})," connects to the server using the server\u2019s public key."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"After connected, text typed into either terminal flows between both peers."}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"server-app"})," will create a key pair and then start a server that will listen on the generated key pair. The public key is logged into the console. Copy it for instantiating the client."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Create the ",(0,r.jsx)(n.code,{children:"server-app"})," project with the following commands:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir server-app\ncd server-app\npear init -y -t terminal\nnpm install hyperdht b4a bare-process\n\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["Replace the content of the ",(0,r.jsx)(n.code,{children:"server-app/index.js"})," file to the following:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import DHT from 'hyperdht'\nimport b4a from 'b4a'\nimport process from 'bare-process'\n\nconst dht = new DHT()\n\n// This keypair is the peer identifier in the DHT\nconst keyPair = DHT.keyPair()\n\nconst server = dht.createServer(conn => {\n  console.log('got connection!')\n  process.stdin.pipe(conn).pipe(process.stdout)\n})\n\nserver.listen(keyPair).then(() => {\n  console.log('listening on:', b4a.toString(keyPair.publicKey, 'hex'))\n})\n\n// Unnannounce the public key before exiting the process\n// (This is not a requirement, but it helps avoid DHT pollution)\nPear.teardown(() => server.close())\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["Open and run the ",(0,r.jsx)(n.code,{children:"server-app"})," with ",(0,r.jsx)(n.code,{children:"pear run --dev ."}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The terminal The terminal prints a public key. Copy this key for use by the client."}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsxs)(n.li,{children:["In another terminal create the ",(0,r.jsx)(n.code,{children:"client-app"})," project with the following commands:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir client-app\ncd client-app\npear init -y -t terminal\nnpm install hyperdht b4a bare-process\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsxs)(n.li,{children:["Replace the ",(0,r.jsx)(n.code,{children:"client-app/index.js"})," file with to the following:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import DHT from 'hyperdht'\nimport b4a from 'b4a'\nimport process from 'bare-process'\n\nconst key = Pear.config.args[0]\nif (!key) throw new Error('provide a key')\n\nconsole.log('Connecting to:', key)\nconst publicKey = b4a.from(key, 'hex')\n\nconst dht = new DHT()\nconst conn = dht.connect(publicKey)\nconn.once('open', () => console.log('got connection!'))\n\nprocess.stdin.pipe(conn).pipe(process.stdout)\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"6",children:["\n",(0,r.jsx)(n.li,{children:"Start the client and provide the server key:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pear run --dev . <SUPPLY KEY HERE>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"client-app"})," will spin up a client, and the public key copied earlier must be supplied as a command line argument for connecting to the server. The client process will log ",(0,r.jsx)(n.code,{children:"got connection"})," into the console when it connects to the server."]}),"\n",(0,r.jsx)(n.p,{children:"After it's connected, try typing in both terminals."})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var i=t(6540);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);